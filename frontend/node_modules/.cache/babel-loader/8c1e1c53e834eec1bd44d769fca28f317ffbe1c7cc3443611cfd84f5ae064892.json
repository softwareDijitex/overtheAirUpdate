{"ast":null,"code":"import _objectSpread from\"/Users/nidhi/Documents/Inoweave/OnTheFlyUpdate/Code/cursor/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from\"react\";import axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function useAuth(){return useContext(AuthContext);}// Function to decode JWT token\nconst decodeToken=token=>{try{const base64Url=token.split(\".\")[1];const base64=base64Url.replace(/-/g,\"+\").replace(/_/g,\"/\");const jsonPayload=decodeURIComponent(atob(base64).split(\"\").map(function(c){return\"%\"+(\"00\"+c.charCodeAt(0).toString(16)).slice(-2);}).join(\"\"));return JSON.parse(jsonPayload);}catch(error){console.error(\"Error decoding token:\",error);return null;}};export function AuthProvider(_ref){let{children}=_ref;const[token,setToken]=useState(null);const[user,setUser]=useState(null);// Set up axios interceptor to include token in all requests\nuseEffect(()=>{const interceptor=axios.interceptors.request.use(config=>{if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;},error=>{return Promise.reject(error);});// Cleanup interceptor on unmount\nreturn()=>{axios.interceptors.request.eject(interceptor);};},[token]);const login=async(email,password)=>{try{const response=await axios.post(\"https://ontheflyupdate-cvg3c5dveqg3byav.canadacentral-01.azurewebsites.net/api/customers/login\",{email,password});if(response.data.token){setToken(response.data.token);// Decode token to get user info\nconst decodedToken=decodeToken(response.data.token);if(decodedToken){setUser(_objectSpread(_objectSpread({},response.data),{},{customer_id:decodedToken.customer_id,email:decodedToken.email,is_admin:decodedToken.is_admin}));}else{setUser(response.data);}return{success:true};}else{return{success:false,error:\"Login failed\"};}}catch(error){var _error$response,_error$response$data;console.error(\"Login error:\",error);return{success:false,error:((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"Login failed\"};}};const adminLogin=async(email,password)=>{try{const response=await axios.post(\"https://ontheflyupdate-cvg3c5dveqg3byav.canadacentral-01.azurewebsites.net/api/customers/admin/login\",{email,password});if(response.data.token){setToken(response.data.token);// Decode token to get user info including is_admin\nconst decodedToken=decodeToken(response.data.token);if(decodedToken){setUser(_objectSpread(_objectSpread({},response.data),{},{customer_id:decodedToken.customer_id,email:decodedToken.email,is_admin:decodedToken.is_admin}));}else{setUser(response.data);}return{success:true};}else{return{success:false,error:\"Admin login failed\"};}}catch(error){var _error$response2,_error$response2$data;console.error(\"Admin login error:\",error);return{success:false,error:((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Admin login failed\"};}};const register=async userData=>{try{const response=await axios.post(\"https://ontheflyupdate-cvg3c5dveqg3byav.canadacentral-01.azurewebsites.net/api/customers/register\",userData);if(response.data.token){setToken(response.data.token);// Decode token to get user info\nconst decodedToken=decodeToken(response.data.token);if(decodedToken){setUser(_objectSpread(_objectSpread({},response.data),{},{customer_id:decodedToken.customer_id,email:decodedToken.email,is_admin:decodedToken.is_admin}));}else{setUser(response.data);}return{success:true};}else{return{success:false,error:\"Registration failed\"};}}catch(error){var _error$response3,_error$response3$data;console.error(\"Registration error:\",error);return{success:false,error:((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||\"Registration failed\"};}};const logout=()=>{setToken(null);setUser(null);};const value={token,user,login,adminLogin,register,logout};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","jsx","_jsx","AuthContext","useAuth","decodeToken","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","error","console","AuthProvider","_ref","children","setToken","user","setUser","interceptor","interceptors","request","use","config","headers","Authorization","concat","Promise","reject","eject","login","email","password","response","post","data","decodedToken","_objectSpread","customer_id","is_admin","success","_error$response","_error$response$data","message","adminLogin","_error$response2","_error$response2$data","register","userData","_error$response3","_error$response3$data","logout","value","Provider"],"sources":["/Users/nidhi/Documents/Inoweave/OnTheFlyUpdate/Code/cursor/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\n// Function to decode JWT token\nconst decodeToken = (token) => {\n  try {\n    const base64Url = token.split(\".\")[1];\n    const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const jsonPayload = decodeURIComponent(\n      atob(base64)\n        .split(\"\")\n        .map(function (c) {\n          return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join(\"\")\n    );\n    return JSON.parse(jsonPayload);\n  } catch (error) {\n    console.error(\"Error decoding token:\", error);\n    return null;\n  }\n};\n\nexport function AuthProvider({ children }) {\n  const [token, setToken] = useState(null);\n  const [user, setUser] = useState(null);\n\n  // Set up axios interceptor to include token in all requests\n  useEffect(() => {\n    const interceptor = axios.interceptors.request.use(\n      (config) => {\n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n      },\n      (error) => {\n        return Promise.reject(error);\n      }\n    );\n\n    // Cleanup interceptor on unmount\n    return () => {\n      axios.interceptors.request.eject(interceptor);\n    };\n  }, [token]);\n\n  const login = async (email, password) => {\n    try {\n      const response = await axios.post(\n        \"https://ontheflyupdate-cvg3c5dveqg3byav.canadacentral-01.azurewebsites.net/api/customers/login\",\n        {\n          email,\n          password,\n        }\n      );\n\n      if (response.data.token) {\n        setToken(response.data.token);\n        // Decode token to get user info\n        const decodedToken = decodeToken(response.data.token);\n        if (decodedToken) {\n          setUser({\n            ...response.data,\n            customer_id: decodedToken.customer_id,\n            email: decodedToken.email,\n            is_admin: decodedToken.is_admin,\n          });\n        } else {\n          setUser(response.data);\n        }\n        return { success: true };\n      } else {\n        return { success: false, error: \"Login failed\" };\n      }\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      return {\n        success: false,\n        error: error.response?.data?.message || \"Login failed\",\n      };\n    }\n  };\n\n  const adminLogin = async (email, password) => {\n    try {\n      const response = await axios.post(\n        \"https://ontheflyupdate-cvg3c5dveqg3byav.canadacentral-01.azurewebsites.net/api/customers/admin/login\",\n        {\n          email,\n          password,\n        }\n      );\n\n      if (response.data.token) {\n        setToken(response.data.token);\n        // Decode token to get user info including is_admin\n        const decodedToken = decodeToken(response.data.token);\n        if (decodedToken) {\n          setUser({\n            ...response.data,\n            customer_id: decodedToken.customer_id,\n            email: decodedToken.email,\n            is_admin: decodedToken.is_admin,\n          });\n        } else {\n          setUser(response.data);\n        }\n        return { success: true };\n      } else {\n        return { success: false, error: \"Admin login failed\" };\n      }\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      return {\n        success: false,\n        error: error.response?.data?.message || \"Admin login failed\",\n      };\n    }\n  };\n\n  const register = async (userData) => {\n    try {\n      const response = await axios.post(\n        \"https://ontheflyupdate-cvg3c5dveqg3byav.canadacentral-01.azurewebsites.net/api/customers/register\",\n        userData\n      );\n\n      if (response.data.token) {\n        setToken(response.data.token);\n        // Decode token to get user info\n        const decodedToken = decodeToken(response.data.token);\n        if (decodedToken) {\n          setUser({\n            ...response.data,\n            customer_id: decodedToken.customer_id,\n            email: decodedToken.email,\n            is_admin: decodedToken.is_admin,\n          });\n        } else {\n          setUser(response.data);\n        }\n        return { success: true };\n      } else {\n        return { success: false, error: \"Registration failed\" };\n      }\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      return {\n        success: false,\n        error: error.response?.data?.message || \"Registration failed\",\n      };\n    }\n  };\n\n  const logout = () => {\n    setToken(null);\n    setUser(null);\n  };\n\n  const value = {\n    token,\n    user,\n    login,\n    adminLogin,\n    register,\n    logout,\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}